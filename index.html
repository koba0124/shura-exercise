<html>
    <head>
        <script src="./pdfjs-dist/build/pdf.js"></script>
        <script src="./easytimer.min.js"></script>
        <script>
            const pdfjsLib = window['pdfjs-dist/build/pdf'];
            let currentPage = 1;
            let pdf;
            let timer = new Timer();
            let isStart = false;
            timer.addEventListener('secondsUpdated', function (e) {
                countDownDisp.innerText = timer.getTimeValues().toString();
            });
            const countDownDisp = document.getElementById('countDown');
            pdfjsLib.GlobalWorkerOptions.workerSrc = "./pdfjs-dist/build/pdf.worker.js"
            async function uploadPdf(e) {
                // PDFファイルデータをArrayBuffer型で取得
                const fileData = await readFileAsync(e.files[0])

                // PDFファイルのパース
                pdf = await pdfjsLib.getDocument({
                    data: fileData,
                    cMapUrl: './pdfjs-dist/web/cmaps/',
                    cMapPacked: true,
                }).promise;
                currentPage = 1;
                render(currentPage);
            };
            function readFileAsync(file) {
            return new Promise((resolve, reject) => {
                    const reader = new FileReader()
                    reader.onload = () => {
                    resolve(reader.result)
                    }
                    reader.onerror = reject
                    reader.readAsArrayBuffer(file)
                })
            };
            async function render(num){
                const canvas = document.getElementById('display');
                const page = await pdf.getPage(num)
                const viewport = page.getViewport({ scale: 1 })
                canvas.height = viewport.height
                canvas.width = viewport.width
                const context = canvas.getContext('2d')
                var task = page.render({
                    canvasContext: context,
                    viewport: viewport,
                })
                await task.promise
                countDown(30);
            }
            function nextPage(){
                if(pdf.numPages != currentPage){
                    render(++currentPage);
                }
            }
            function prevPage(){
                if(1 != currentPage){
                    render(--currentPage);
                }
            }
            function countDown(sec){
                timer.start({countdown: true, startValues: {seconds: sec}});
            }
                
                
                
                
                
                
                
        </script>
    </head>
    <body>
        <div>
            <input type="file" accept="application/pdf" onchange="uploadPdf(this)">
        </div>
        <div>
            <canvas id="display" />
        </div>
        <div id="countDown">00:00:00</div>
        <div>
            <input type="button" onclick="nextPage()" value=" next ">

            <input type="button" onclick="prevPage()" value=" prev ">
        </div>
        <div>
            <input type="button" onclick="startGame()" value=" S T A R T  ">

            <input type="button" onclick="prevPage()" value=" prev ">
        </div>
    </body>
</html>
